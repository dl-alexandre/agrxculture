---
// Hero Component - Agricultural Portfolio Website
// Implements hero section with agricultural branding, parallax effects, and responsive design

export interface Props {
  title?: string;
  subtitle?: string;
  ctaText?: string;
  ctaLink?: string;
  backgroundImage?: string;
  headshot?: string;
}

const {
  title = "Agrxculture",
  subtitle = "Building data-driven farms for a more productive tomorrow",
  ctaText = "Explore Our Agricultural Solutions",
  ctaLink = `${import.meta.env.BASE_URL.replace(/\/$/, '')}/services`,
  backgroundImage = `${import.meta.env.BASE_URL}images/hero/agricultural-background-desktop.svg`,
  headshot = `${import.meta.env.BASE_URL}images/hero/agrxculture-logo.svg`
} = Astro.props;
---

<section class="hero" role="banner" aria-labelledby="hero-title">
  <!-- Background with parallax effect - Enhanced for Task 8 -->
  <div class="hero-background hero-image-responsive" data-parallax>
    <picture class="hero-bg-picture">
      <!-- WebP format for modern browsers -->
      <source 
        media="(max-width: 479px)"
        type="image/webp"
        srcset={`${import.meta.env.BASE_URL}images/hero/agricultural-background-mobile.webp`}
      />
      <source 
        media="(min-width: 480px) and (max-width: 767px)"
        type="image/webp"
        srcset={`${import.meta.env.BASE_URL}images/hero/agricultural-background-tablet.webp`}
      />
      <source 
        media="(min-width: 768px)"
        type="image/webp"
        srcset={`${import.meta.env.BASE_URL}images/hero/agricultural-background-desktop.webp`}
      />
      
      <!-- SVG fallbacks for different screen sizes -->
      <source 
        media="(max-width: 479px)"
        srcset={`${import.meta.env.BASE_URL}images/hero/agricultural-background-mobile.svg`}
      />
      <source 
        media="(min-width: 480px) and (max-width: 767px)"
        srcset={`${import.meta.env.BASE_URL}images/hero/agricultural-background-tablet.svg`}
      />
      <img 
        src={backgroundImage}
        alt="Modern agricultural field with IoT sensors and precision farming technology"
        class="hero-bg-image"
        loading="eager"
        fetchpriority="high"
        decoding="async"
        width="1200"
        height="800"
      />
    </picture>
    
    <!-- Overlay for better text readability -->
    <div class="hero-overlay" aria-hidden="true"></div>
  </div>

  <!-- Hero content -->
  <div class="hero-container">
    <div class="hero-content">
      <!-- Professional headshot - Enhanced for Task 8 -->
      <div class="hero-headshot profile-image-responsive">
        <picture>
          <!-- WebP format -->
          <source 
            type="image/webp"
            srcset={`${import.meta.env.BASE_URL}images/hero/agrxculture-logo.webp`}
          />
          <!-- SVG fallback -->
          <img 
            src={headshot}
            alt="Agrxculture - Agricultural Technology Company"
            class="headshot-image"
            loading="eager"
            decoding="async"
            width="200"
            height="200"
          />
        </picture>
      </div>

      <!-- Main content -->
      <div class="hero-text">
        <h1 id="hero-title" class="hero-title">
          {title}
        </h1>
        
        <p class="hero-subtitle">
          {subtitle}
        </p>

        <!-- Key value propositions -->
        <div class="hero-highlights">
          <div class="highlight-item">
            <svg class="highlight-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M12 2L2 7l10 5 10-5-10-5z"/>
              <path d="M2 17l10 5 10-5"/>
              <path d="M2 12l10 5 10-5"/>
            </svg>
            <span>IoT Farm Solutions</span>
          </div>
          
          <div class="highlight-item">
            <svg class="highlight-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
              <line x1="8" y1="21" x2="16" y2="21"/>
              <line x1="12" y1="17" x2="12" y2="21"/>
            </svg>
            <span>Mobile Farm Apps</span>
          </div>
          
          <div class="highlight-item">
            <svg class="highlight-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <polyline points="22,12 18,12 15,21 9,3 6,12 2,12"/>
            </svg>
            <span>Data Analytics</span>
          </div>
        </div>

        <!-- Call to action -->
        <div class="hero-cta">
          <a href={ctaLink} class="cta-button" role="button">
            {ctaText}
            <svg class="cta-arrow" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <line x1="5" y1="12" x2="19" y2="12"/>
              <polyline points="12,5 19,12 12,19"/>
            </svg>
          </a>
          
          <!-- Secondary CTA -->
          <a href={`${import.meta.env.BASE_URL.replace(/\/$/, '')}/showcase`} class="cta-secondary">
            View Projects
          </a>
        </div>
      </div>
    </div>

    <!-- Scroll indicator -->
    <div class="scroll-indicator" aria-hidden="true">
      <div class="scroll-text">Scroll to explore</div>
      <div class="scroll-arrow">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="6,9 12,15 18,9"/>
        </svg>
      </div>
    </div>
  </div>
</section>

<style>
  /* Hero Section Styles */
  .hero {
    position: relative;
    min-height: 100vh;
    display: flex;
    align-items: center;
    overflow: hidden;
    background-color: var(--color-primary-dark); /* Fallback color */
  }

  /* Background and Parallax */
  .hero-background {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 120%; /* Extra height for parallax effect */
    z-index: 1;
    will-change: transform;
  }

  .hero-bg-picture {
    width: 100%;
    height: 100%;
    display: block;
  }

  .hero-bg-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
    display: block;
  }

  .hero-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      135deg,
      rgba(30, 125, 50, 0.7) 0%,
      rgba(139, 69, 19, 0.6) 50%,
      rgba(30, 125, 50, 0.8) 100%
    );
    z-index: 2;
  }

  /* Hero Content */
  .hero-container {
    position: relative;
    z-index: 3;
    width: 100%;
    max-width: var(--container-xl);
    margin: 0 auto;
    padding: 0 var(--space-md);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }

  .hero-content {
    display: grid;
    grid-template-columns: auto 1fr;
    gap: var(--space-2xl);
    align-items: center;
    max-width: 1000px;
  }

  /* Headshot */
  .hero-headshot {
    flex-shrink: 0;
  }

  .headshot-image {
    width: 200px;
    height: 200px;
    border-radius: 50%;
    border: 4px solid rgba(255, 255, 255, 0.9);
    box-shadow: var(--shadow-xl);
    object-fit: cover;
    object-position: center;
    transition: transform var(--transition-normal);
  }

  .headshot-image:hover {
    transform: scale(1.05);
  }

  /* Text Content */
  .hero-text {
    color: white;
  }

  .hero-title {
    font-size: var(--font-size-5xl);
    font-weight: var(--font-weight-bold);
    line-height: var(--line-height-tight);
    margin: 0 0 var(--space-md);
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
  }

  .hero-subtitle {
    font-size: var(--font-size-xl);
    font-weight: var(--font-weight-medium);
    line-height: var(--line-height-relaxed);
    margin: 0 0 var(--space-xl);
    opacity: 0.95;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
  }

  /* Highlights */
  .hero-highlights {
    display: flex;
    gap: var(--space-lg);
    margin-bottom: var(--space-2xl);
    flex-wrap: wrap;
  }

  .highlight-item {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    padding: var(--space-sm) var(--space-md);
    background: rgba(255, 255, 255, 0.15);
    border-radius: var(--radius-full);
    backdrop-filter: blur(8px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
    transition: all var(--transition-normal);
  }

  .highlight-item:hover {
    background: rgba(255, 255, 255, 0.25);
    transform: translateY(-2px);
  }

  .highlight-icon {
    width: 20px;
    height: 20px;
    flex-shrink: 0;
  }

  /* Call to Action */
  .hero-cta {
    display: flex;
    gap: var(--space-lg);
    align-items: center;
    flex-wrap: wrap;
  }

  .cta-button {
    display: inline-flex;
    align-items: center;
    gap: var(--space-sm);
    padding: var(--space-md) var(--space-xl);
    background: var(--color-accent);
    color: white;
    text-decoration: none;
    font-weight: var(--font-weight-semibold);
    font-size: var(--font-size-lg);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg);
    transition: all var(--transition-normal);
    min-height: 48px;
    min-width: 48px;
    border: 2px solid transparent;
  }

  .cta-button:hover,
  .cta-button:focus {
    background: var(--color-accent-dark);
    transform: translateY(-2px);
    box-shadow: var(--shadow-xl);
  }

  .cta-button:focus {
    outline: none;
    border-color: white;
  }

  .cta-arrow {
    width: 20px;
    height: 20px;
    transition: transform var(--transition-fast);
  }

  .cta-button:hover .cta-arrow {
    transform: translateX(4px);
  }

  .cta-secondary {
    color: white;
    text-decoration: none;
    font-weight: var(--font-weight-medium);
    padding: var(--space-md) var(--space-lg);
    border: 2px solid rgba(255, 255, 255, 0.6);
    border-radius: var(--radius-lg);
    transition: all var(--transition-normal);
    min-height: 48px;
    min-width: 48px;
    display: flex;
    align-items: center;
  }

  .cta-secondary:hover,
  .cta-secondary:focus {
    background: rgba(255, 255, 255, 0.1);
    border-color: white;
    transform: translateY(-1px);
  }

  .cta-secondary:focus {
    outline: 2px solid white;
    outline-offset: 2px;
  }

  /* Scroll Indicator */
  .scroll-indicator {
    position: absolute;
    bottom: var(--space-2xl);
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-sm);
    color: white;
    opacity: 0.8;
    animation: bounce 2s infinite;
  }

  .scroll-text {
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .scroll-arrow {
    width: 24px;
    height: 24px;
  }

  @keyframes bounce {
    0%, 20%, 50%, 80%, 100% {
      transform: translateX(-50%) translateY(0);
    }
    40% {
      transform: translateX(-50%) translateY(-10px);
    }
    60% {
      transform: translateX(-50%) translateY(-5px);
    }
  }

  /* Tablet Styles - Task 8 Enhanced (768px to 1023px) */
  @media (min-width: 768px) and (max-width: 1023px) {
    .hero-content {
      gap: var(--space-xl);
      max-width: 900px;
    }

    .hero-headshot {
      width: 160px;
      height: 160px;
    }

    .hero-title {
      font-size: var(--font-size-4xl);
    }

    .hero-subtitle {
      font-size: var(--font-size-lg);
    }

    .hero-highlights {
      gap: var(--space-md);
      justify-content: center;
    }

    .highlight-item {
      font-size: var(--font-size-sm);
      padding: var(--space-sm) var(--space-md);
    }

    .highlight-icon {
      width: 18px;
      height: 18px;
    }
    
    .hero-cta {
      justify-content: center;
    }
    
    .cta-button,
    .cta-secondary {
      min-height: var(--touch-target-comfortable);
    }
  }

  /* Mobile Styles - Task 8 Enhanced (480px to 767px) */
  @media (min-width: 480px) and (max-width: 767px) {
    .hero {
      min-height: 90vh;
      text-align: center;
    }

    .hero-container {
      padding: 0 var(--space-md);
      justify-content: center;
    }

    .hero-content {
      grid-template-columns: 1fr;
      gap: var(--space-xl);
      text-align: center;
      max-width: 600px;
    }

    .hero-headshot {
      width: 140px;
      height: 140px;
      margin: 0 auto;
    }

    .hero-title {
      font-size: var(--font-size-3xl);
    }

    .hero-subtitle {
      font-size: var(--font-size-lg);
    }

    .hero-highlights {
      justify-content: center;
      gap: var(--space-sm);
    }

    .highlight-item {
      font-size: var(--font-size-sm);
      padding: var(--space-sm) var(--space-md);
    }

    .highlight-icon {
      width: 18px;
      height: 18px;
    }

    .hero-cta {
      flex-direction: row;
      gap: var(--space-md);
      justify-content: center;
    }

    .cta-button,
    .cta-secondary {
      min-height: var(--touch-target-comfortable);
      flex: 1;
      max-width: 200px;
    }

    .scroll-indicator {
      bottom: var(--space-xl);
    }

    /* Disable parallax on mobile for performance */
    .hero-background {
      height: 100%;
    }
  }

  /* Low-end Mobile Styles - Task 8 Specific (max-width: 479px) */
  @media (max-width: 479px) {
    .hero {
      min-height: 80vh;
      text-align: center;
    }

    .hero-container {
      padding: 0 var(--space-sm);
      justify-content: center;
    }

    .hero-content {
      grid-template-columns: 1fr;
      gap: var(--space-lg);
      text-align: center;
    }

    .hero-headshot {
      width: 100px;
      height: 100px;
      margin: 0 auto;
    }

    .hero-title {
      font-size: var(--font-size-2xl);
      line-height: 1.2;
    }

    .hero-subtitle {
      font-size: var(--font-size-base);
    }

    .hero-highlights {
      flex-direction: column;
      gap: var(--space-xs);
      align-items: center;
    }

    .highlight-item {
      font-size: var(--font-size-xs);
      padding: var(--space-xs) var(--space-sm);
      width: 100%;
      max-width: 200px;
      justify-content: center;
    }

    .highlight-icon {
      width: 16px;
      height: 16px;
    }

    .hero-cta {
      flex-direction: column;
      gap: var(--space-sm);
      align-items: stretch;
    }

    .cta-button,
    .cta-secondary {
      justify-content: center;
      width: 100%;
      min-height: var(--touch-target-comfortable);
      font-size: var(--font-size-base);
    }

    .scroll-indicator {
      bottom: var(--space-md);
      font-size: var(--font-size-xs);
    }

    /* Disable parallax and optimize for low-end devices */
    .hero-background {
      height: 100%;
      will-change: auto;
    }
  }

  /* Extra small mobile */
  @media (max-width: 479px) {
    .hero-container {
      padding: 0 var(--space-xs);
    }

    .hero-title {
      font-size: var(--font-size-2xl);
    }

    .hero-highlights {
      flex-direction: column;
      gap: var(--space-xs);
    }

    .highlight-item {
      justify-content: center;
    }
  }

  /* Reduced Motion Preferences */
  @media (prefers-reduced-motion: reduce) {
    .hero-background {
      height: 100% !important;
    }

    .headshot-image,
    .highlight-item,
    .cta-button,
    .cta-secondary {
      transition: none;
    }

    .headshot-image:hover {
      transform: none;
    }

    .highlight-item:hover,
    .cta-button:hover,
    .cta-secondary:hover {
      transform: none;
    }

    .cta-button:hover .cta-arrow {
      transform: none;
    }

    .scroll-indicator {
      animation: none;
    }
  }

  /* High Contrast Mode */
  @media (prefers-contrast: high) {
    .hero-overlay {
      background: rgba(0, 0, 0, 0.8);
    }

    .headshot-image {
      border-color: white;
      border-width: 3px;
    }

    .highlight-item {
      background: rgba(255, 255, 255, 0.9);
      color: var(--color-text-primary);
      border-color: white;
    }

    .cta-button:focus,
    .cta-secondary:focus {
      outline: 3px solid white;
      outline-offset: 3px;
    }
  }

  /* Print Styles */
  @media print {
    .hero {
      min-height: auto;
      background: white !important;
      color: black !important;
      page-break-inside: avoid;
    }

    .hero-background,
    .hero-overlay,
    .scroll-indicator {
      display: none !important;
    }

    .hero-content {
      grid-template-columns: auto 1fr;
      gap: var(--space-lg);
    }

    .hero-text {
      color: black !important;
    }

    .hero-title,
    .hero-subtitle {
      text-shadow: none !important;
      color: black !important;
    }

    .highlight-item {
      background: #f0f0f0 !important;
      color: black !important;
      border: 1px solid #ccc !important;
    }

    .cta-button,
    .cta-secondary {
      background: white !important;
      color: black !important;
      border: 2px solid black !important;
    }
  }
</style>

<script>
  // Parallax effect implementation
  function initParallax() {
    const parallaxElements = document.querySelectorAll('[data-parallax]');
    
    // Check if user prefers reduced motion
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    
    // Check if device is mobile (disable parallax for performance)
    const isMobile = window.innerWidth < 768;
    
    if (prefersReducedMotion || isMobile) {
      return; // Skip parallax initialization
    }
    
    function updateParallax() {
      const scrolled = window.pageYOffset;
      const rate = scrolled * -0.5; // Parallax speed
      
      parallaxElements.forEach(element => {
        element.style.transform = `translateY(${rate}px)`;
      });
    }
    
    // Use requestAnimationFrame for smooth animation
    let ticking = false;
    
    function requestTick() {
      if (!ticking) {
        requestAnimationFrame(updateParallax);
        ticking = true;
      }
    }
    
    function handleScroll() {
      requestTick();
      ticking = false;
    }
    
    // Add scroll listener with passive option for better performance
    window.addEventListener('scroll', handleScroll, { passive: true });
    
    // Initial call
    updateParallax();
  }
  
  // Initialize when DOM is loaded
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initParallax);
  } else {
    initParallax();
  }
  
  // Smooth scroll for CTA buttons
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      if (target) {
        target.scrollIntoView({
          behavior: 'smooth',
          block: 'start'
        });
      }
    });
  });
</script>