class ContactForm{constructor(){this.form=document.getElementById('contact-form');this.submitBtn=document.getElementById('submit-btn');this.messageTextarea=document.getElementById('message');this.messageCounter=document.getElementById('message-counter');if(!this.form)return;this.init()}init(){this.setupEventListeners();this.updateCharacterCounter();this.setupMobileSupport()}setupEventListeners(){this.messageTextarea.addEventListener('input',()=>this.updateCharacterCounter());const e=this.form.querySelectorAll('input, select, textarea');e.forEach(e=>{e.addEventListener('blur',()=>this.validateField(e));e.addEventListener('input',()=>{e.classList.contains('error')&&this.validateField(e)})});this.form.addEventListener('submit',e=>this.handleSubmit(e))}updateCharacterCounter(){const e=this.messageTextarea.value.length,t=2e3;e>t?(this.messageCounter.textContent=`${t} / ${t} characters`,this.messageCounter.classList.add('error'),this.messageCounter.classList.remove('warning')):(this.messageCounter.textContent=`${e} / ${t} characters`,e>.9*t?(this.messageCounter.classList.add('warning'),this.messageCounter.classList.remove('error')):this.messageCounter.classList.remove('warning','error'))}validateField(e){const t=e.value.trim(),r=e.name,s=document.getElementById(`${e.id}-error`);let i=!0,a='';s&&(s.textContent='',s.style.display='none');e.classList.remove('error');if(e.hasAttribute('required')&&!t)a=`${this.getFieldLabel(r)} is required.`,i=!1;else if('email'===e.type&&t){const r=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;r.test(t)||(a='Please enter a valid email address.',i=!1)}else'eLECT'===e.tagName&&e.hasAttribute('required')&&!t?(a='Please select a project type.',i=!1):'message'===e.id&&t.length>2e3?(a='Message must be 2000 characters or less.',i=!1):'name'===e.id&&t&&t.length<2&&(a='Please enter your full name.',i=!1);return i?(e.setAttribute('aria-invalid','false'),i):(s&&(s.textContent=a,s.style.display='block'),e.classList.add('error'),e.setAttribute('aria-invalid','true'),i)}getFieldLabel(e){const t={name:'Full Name',email:'Email Address',company:'Company/Farm Name','project-type':'Project Type',message:'Project Details'};return t[e]||e}async handleSubmit(e){e.preventDefault();const t=this.form.querySelectorAll('input, select, textarea');let r=!0;t.forEach(e=>{this.validateField(e)||(r=!1)});if(!r){const e=this.form.querySelector('.error');if(e)return void setTimeout(()=>{e.focus(),'scrollIntoView'in e?e.scrollIntoView({behavior:'smooth',block:'center',inline:'nearest'}):e.scrollIntoView()},100)}this.setLoadingState(!0);try{const e=new FormData(this.form);e.append('_subject','New Agrxculture Technology Inquiry');e.append('_replyto',e.get('email'));e.append('_next',window.location.href+'#success');const t=await fetch(this.form.action,{method:'POST',body:e,headers:{Accept:'application/json'}});if(t.ok)this.showSuccess();else{const e=await t.json();throw new Error(e.error||'Form submission failed')}}catch(e){console.error('Form submission error:',e),this.showError(e.message)}finally{this.setLoadingState(!1)}}setLoadingState(e){e?(this.submitBtn.classList.add('loading'),this.submitBtn.disabled=!0,this.submitBtn.setAttribute('aria-busy','true')):(this.submitBtn.classList.remove('loading'),this.submitBtn.disabled=!1,this.submitBtn.setAttribute('aria-busy','false'))}showSuccess(){document.getElementById('form-success').style.display='block';document.getElementById('form-error').style.display='none';this.form.reset();this.updateCharacterCounter();const e=this.form.querySelectorAll('.error');e.forEach(e=>{e.classList.remove('error');e.setAttribute('aria-invalid','false')});const t=this.form.querySelectorAll('.error-message');t.forEach(e=>e.textContent='');document.getElementById('form-success').scrollIntoView({behavior:'smooth',block:'center'});if('function'==typeof gtag){gtag('event','form_submit',{event_category:'Contact',event_label:'Agrxculture Technology Inquiry'})}}showError(e=null){const t=document.getElementById('form-error');document.getElementById('form-error').style.display='block';document.getElementById('form-success').style.display='none';if(e){const r=t.querySelector('p');r&&(r.innerHTML=`There was an issue sending your message: ${e}. Please try again or contact us directly at <a href="mailto:contact@agrxculture.com">contact@agrxculture.com</a>`) }t.scrollIntoView({behavior:'smooth',block:'center'})}setupMobileSupport(){if('ontouchstart'in window){const e=this.form.querySelectorAll('input, select, textarea');e.forEach(e=>{'text'!==e.type&&'email'!==e.type&&'TEXTAREA'!==e.tagName|| (e.addEventListener('focus',()=>{const e=document.querySelector('meta[name="viewport"]');e&&e.setAttribute('content','width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no')}),e.addEventListener('blur',()=>{const e=document.querySelector('meta[name="viewport"]');e&&e.setAttribute('content','width=device-width, initial-scale=1.0')}))})}window.addEventListener('orientationchange',()=>{setTimeout(()=>{const e=this.form.querySelectorAll('input, select, textarea');e.forEach(e=>{e.classList.contains('error')&&this.validateField(e)})},500)})}}document.addEventListener('DOMContentLoaded',()=>{new ContactForm});

